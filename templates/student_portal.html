{% extends 'base.html' %} {% block title %}{{ _('portal.title') }} - {{ _('app_name') }}{% endblock
%} {% block content %}
<div
  id="student-portal"
  class="student-portal"
  data-student-id="{{ student.student_id if student else '' }}"
  data-student-name="{{ student.full_name if student else '' }}"
  data-student-email="{{ student.email if student else '' }}"
  data-student-phone="{{ student.phone if student else '' }}"
>
  {% if not student %}
  <div class="alert alert-warning">
    <i class="fas fa-info-circle me-1"></i>
    {{ _('portal.no_student_info') }}
  </div>
  {% endif %}

  <ul class="nav nav-pills gap-2 mb-4" id="studentPortalTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="student-tab-overview"
        data-bs-toggle="pill"
        data-bs-target="#student-tabpane-overview"
        type="button"
        role="tab"
      >
        <i class="fas fa-layer-group me-1"></i>{{ _('portal.overview') }}
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="student-tab-profile"
        data-bs-toggle="pill"
        data-bs-target="#student-tabpane-profile"
        type="button"
        role="tab"
      >
        <i class="fas fa-user-edit me-1"></i>{{ _('portal.edit_profile') }}
      </button>
    </li>
  </ul>

  <div class="tab-content" id="studentPortalTabContent">
    <div
      class="tab-pane fade show active"
      id="student-tabpane-overview"
      role="tabpanel"
      aria-labelledby="student-tab-overview"
    >
      <div class="row g-4 align-items-stretch">
        <div class="col-12 col-lg-4">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
              <p class="text-uppercase text-muted fw-semibold small mb-1">
                {{ _('portal.student_profile') }}
              </p>
              <h3 class="h5 mb-1" id="student-profile-name">
                {{ student.full_name if student else _('portal.not_defined') }}
              </h3>
              <p class="text-muted mb-3" id="student-profile-code">
                {{ _('portal.student_code') }}: {{ student.student_id if student else '—' }}
              </p>
              <ul class="list-unstyled small text-muted">
                <li>
                  <i class="fas fa-envelope me-2"></i>
                  <span id="student-profile-email">
                    {{ student.email if student and student.email else '—' }}
                  </span>
                </li>
                <li>
                  <i class="fas fa-phone me-2"></i>
                  <span id="student-profile-phone">
                    {{ student.phone if student and student.phone else '—' }}
                  </span>
                </li>
                <li>
                  <i class="fas fa-chalkboard me-2"></i>
                  <span id="student-profile-class">
                    {% if student and student.class_id %}{{ _('portal.admin_class') }} #{{
                    student.class_id }}{% else %}{{ _('portal.not_updated') }}{% endif %}
                  </span>
                </li>
              </ul>
              <div class="mt-3 p-3 bg-light rounded-3 border-0">
                <p class="text-muted text-uppercase small mb-2 fw-semibold">
                  {{ _('reports.statistics') }}
                </p>
                <div class="row g-3">
                  <div class="col-6">
                    <div class="text-center p-2 bg-white rounded-2">
                      <h4 class="mb-1 text-primary" id="student-summary-total">
                        0
                      </h4>
                      <small class="text-muted d-block">{{ _('portal.credit_classes') }}</small>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="text-center p-2 bg-white rounded-2">
                      <h4 class="mb-1 text-success" id="student-summary-active">
                        0
                      </h4>
                      <small class="text-muted d-block">{{ _('portal.open_sessions') }}</small>
                    </div>
                  </div>
                </div>
              </div>
              <p class="small text-muted mt-3 mb-0">
                {{ _('portal.sync_note') }}
              </p>
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm border-0 h-100">
            <div
              class="card-header bg-transparent border-bottom-0 d-flex justify-content-between align-items-center"
            >
              <div>
                <h5 class="card-title mb-0">{{ _('portal.registered_classes') }}</h5>
                <small class="text-muted"
                  >{{ _('portal.active_classes_desc') }}</small
                >
              </div>
              <button
                class="btn btn-sm btn-outline-primary"
                id="student-refresh"
              >
                <i class="fas fa-rotate-right me-1"></i>{{ _('portal.reload') }}
              </button>
            </div>
            <div class="card-body">
              <div id="student-class-loading" class="text-center py-5">
                <div class="spinner-border text-primary mb-3" role="status">
                  <span class="visually-hidden">{{ _('common.loading') }}</span>
                </div>
                <p class="text-muted mb-0">{{ _('portal.loading_classes') }}</p>
              </div>
              <div id="student-class-empty" class="text-center py-5 d-none">
                <i class="fas fa-inbox fa-3x text-muted mb-3 opacity-50"></i>
                <h6 class="text-muted mb-2">{{ _('portal.no_credit_classes') }}</h6>
                <p class="text-muted small mb-0">
                  {{ _('portal.no_classes_hint') }}
                </p>
              </div>
              <div id="student-class-list" class="row g-3"></div>
            </div>
          </div>
        </div>
        {% if current_role == 'student' %}
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div
              class="card-header bg-transparent border-bottom-0 d-flex justify-content-between align-items-center"
            >
              <div>
                <h5 class="card-title mb-0">{{ _('portal.online_attendance') }}</h5>
                <small class="text-muted"
                  >{{ _('portal.online_attendance_hint') }}</small
                >
              </div>
            </div>
            <div class="card-body">
              <div class="row g-3 align-items-end">
                <div class="col-md-4">
                  <label class="form-label">{{ _('portal.action') }}</label>
                  <div
                    class="btn-group w-100"
                    role="group"
                    aria-label="{{ _('portal.select_action') }}"
                  >
                    <input
                      type="radio"
                      class="btn-check"
                      name="student-action"
                      id="student-action-checkin"
                      value="checkin"
                      autocomplete="off"
                      checked
                    />
                    <label
                      class="btn btn-outline-primary"
                      for="student-action-checkin"
                      >{{ _('attendance.check_in') }}</label
                    >
                    <input
                      type="radio"
                      class="btn-check"
                      name="student-action"
                      id="student-action-checkout"
                      value="checkout"
                      autocomplete="off"
                    />
                    <label
                      class="btn btn-outline-primary"
                      for="student-action-checkout"
                      >{{ _('attendance.check_out') }}</label
                    >
                  </div>
                </div>
                <div class="col-md-5">
                  <label for="student-credit-class-select" class="form-label"
                    >{{ _('portal.credit_class') }}</label
                  >
                  <select class="form-select" id="student-credit-class-select">
                    <option value="">{{ _('portal.select_credit_class') }}</option>
                  </select>
                  <div class="form-text text-muted" id="student-session-hint">
                    {{ _('portal.select_open_session') }}
                  </div>
                </div>
                <div class="col-md-3 text-md-end">
                  <button
                    class="btn btn-primary w-100 mb-2"
                    id="student-start-camera"
                    disabled
                  >
                    <i class="fas fa-play me-1"></i>{{ _('portal.start') }}
                  </button>
                  <button
                    class="btn btn-outline-secondary w-100 d-none"
                    id="student-stop-camera"
                  >
                    <i class="fas fa-stop me-1"></i>{{ _('portal.stop') }}
                  </button>
                </div>
              </div>
              <div
                class="alert alert-info mt-3 d-none"
                id="student-session-alert"
              ></div>
              <div id="student-camera-slot" class="mt-4"></div>
            </div>
          </div>
        </div>
        {% endif %}
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div
              class="card-header bg-transparent border-bottom-0 d-flex justify-content-between align-items-center"
            >
              <div>
                <h5 class="card-title mb-0">{{ _('portal.attendance_history') }}</h5>
                <small class="text-muted"
                  >{{ _('portal.history_limit') }}</small
                >
              </div>
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                id="student-history-refresh"
              >
                <i class="fas fa-history me-1"></i>{{ _('common.update') }}
              </button>
            </div>
            <div class="card-body">
              <div id="student-history-loading" class="text-center py-4">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="text-muted mt-3 mb-0">
                  {{ _('portal.loading_history') }}
                </p>
              </div>
              <div id="student-history-empty" class="text-center py-4 d-none">
                <p class="text-muted mb-0">{{ _('portal.no_history') }}</p>
              </div>
              <div id="student-history-list" class="list-group"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="tab-pane fade"
      id="student-tabpane-profile"
      role="tabpanel"
      aria-labelledby="student-tab-profile"
    >
      <div class="row g-4">
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-transparent border-bottom-0">
              <h5 class="card-title mb-0">{{ _('portal.edit_personal_info') }}</h5>
              <small class="text-muted"
                >{{ _('portal.edit_info_desc') }}</small
              >
            </div>
            <div class="card-body">
              <div
                id="student-profile-alert"
                class="alert d-none"
                role="alert"
              ></div>
              {% if student %}
              <form
                id="student-profile-form"
                class="needs-validation"
                novalidate
              >
                <div class="mb-3">
                  <label
                    for="student-profile-field-full-name"
                    class="form-label"
                    >{{ _('student.full_name') }}</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="student-profile-field-full-name"
                    name="full_name"
                    value="{{ student.full_name or '' }}"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="student-profile-field-email" class="form-label"
                    >{{ _('student.email') }}</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="student-profile-field-email"
                    name="email"
                    value="{{ student.email or '' }}"
                    placeholder="ten@gmail.com"
                  />
                  <div class="form-text">
                    {{ _('portal.email_hint') }}
                  </div>
                </div>
                <div class="mb-4">
                  <label for="student-profile-field-phone" class="form-label"
                    >{{ _('student.phone') }}</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="student-profile-field-phone"
                    name="phone"
                    value="{{ student.phone or '' }}"
                    placeholder="0901234567"
                  />
                </div>
                <div class="text-end">
                  <button
                    type="submit"
                    class="btn btn-primary"
                    id="student-profile-save"
                  >
                    <i class="fas fa-save me-1"></i>{{ _('portal.save_changes') }}
                  </button>
                </div>
              </form>
              {% else %}
              <p class="text-muted mb-0">
                {{ _('portal.cannot_edit') }}
              </p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% if current_role == 'student' %}
<div id="student-camera-wrapper" class="d-none">
  {% include 'components/camera_feed.html' %}
</div>
{% endif %} {% endblock %}
